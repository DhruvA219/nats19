<!DOCTYPE html>
<html lang="en">
<head>
  <title>Predictions</title>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
</head>
<body>

<div class="container" style="margin-left: 22%;" id="first-id">
  <h2>Add Predictions</h2>
  <form id="fantasy-table" class="form-horizontal">
    <div class="form-group">
      <label class="control-label col-sm-2">Name of the participant:</label>
      <div class="col-sm-5">
        <input type="text" class="form-control" id="name-participant">
      </div>
    </div>
  </form>

  <button id ="save-name" type="submit" class="btn btn-default" style="margin-left: 30%;">Save</button>

  <br><br><br><br><br><br>

</div>

<div class="container" style="margin-left: 22%; display:none;" id="second-id">
  <h2 id="enter-predictions-header">Enter predictions for</h2>
  <form id="fantasy-table" class="form-horizontal">
    <div class="form-group">
      <label class="control-label col-sm-2">3x3 winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3w">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">3x3 second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3s">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">3x3 third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3t">
      </div>
    </div>

    <br><br>
    
    <div class="form-group">
      <label class="control-label col-sm-2">4x4 winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="4x4w">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">4x4 second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="4x4s">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">4x4 third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="4x4t">
      </div>
    </div>

    <br><br>

    <div class="form-group">
      <label class="control-label col-sm-2">3x3 OH winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3ohw">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">3x3 OH second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3ohs">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">3x3 OH third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="3x3oht">
      </div>
    </div>

    <br><br>

    <div class="form-group">
      <label class="control-label col-sm-2">Skewb winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="skewbw">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Skewb second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="skewbs">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Skewb third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="skewbt">
      </div>
    </div>

    <br><br>

    <div class="form-group">
      <label class="control-label col-sm-2">Pyraminx winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="pyraw">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Pyraminx second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="pyras">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">Pyraminx third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="pyrat">
      </div>
    </div>

    <br><br>

    <div class="form-group">
      <label class="control-label col-sm-2">2x2 winner:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="2x2w">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">2x2 second place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="2x2s">
      </div>
    </div>
    <div class="form-group">
      <label class="control-label col-sm-2">2x2 third place:</label>
      <div class="col-sm-5">          
        <input type="text" class="form-control" id="2x2t">
      </div>
    </div>
  </form>

  <button id ="record-save-fantasy" type="submit" class="btn btn-default" style="margin-left: 30%;">Save Predictions</button>

  <br><br><br><br><br><br>

</div>

<div class="container">
  <table id="final-table" class="table">
    <tr>
      <th>
        Name
      </th>
      <th>
        Points
      </th>
    </tr>
  </table>
</div>


</body>

<script>
  var finalList = {};
  var currentName;

  function calculatePointsForOneEvent(t, a, b, c, x, y, z) {
    var points = 0;
    var numberOfParticipants = parseInt(t);
    if(x.toUpperCase() === a.toUpperCase()) {
      points+=30;
    } else if(x.toUpperCase() === b.toUpperCase()) {
      points+=15;
    } else if(x.toUpperCase() === c.toUpperCase()) {
      points+=10;
    }

    if(y.toUpperCase() === a.toUpperCase()) {
      points+=22.5;
    } else if(y.toUpperCase() === b.toUpperCase()) {
      points+=15;
    } else if(y.toUpperCase() === c.toUpperCase()) {
      points+=10;
    }

    if(z.toUpperCase() === a.toUpperCase()) {
      points+=20;
    } else if(z.toUpperCase() === b.toUpperCase()) {
      points+=12.5;
    } else if(z.toUpperCase() === c.toUpperCase()) {
      points+=10;
    }

    return 1.0*numberOfParticipants*points;    
  } 

  function callCalculatePointsForOneEvent(t, a, b, c) {
    return calculatePointsForOneEvent(
      fantasyPodiumInfo[t],
      fantasyPodiumInfo[a],
      fantasyPodiumInfo[b],
      fantasyPodiumInfo[c], 
      document.getElementById(a).value.trim(),
      document.getElementById(b).value.trim(),
      document.getElementById(c).value.trim()
      );
  }

  var fantasyPodiumInfo = JSON.parse(localStorage["fantasyPodiumInfo"]);
  console.log(fantasyPodiumInfo);

  $("#save-name").click(function(){
    var name = document.getElementById("name-participant");
    var headerText = document.getElementById("enter-predictions-header").innerText;
    headerText = headerText + " " + name.value + ": ";
    currentName = name.value;
    document.getElementById('enter-predictions-header').innerText = headerText;
    document.getElementById('first-id').style.display = "none";
    document.getElementById('second-id').style.display = "block";
  });

  $("#record-save-fantasy").click(function(){
    var points = 0;
    points += callCalculatePointsForOneEvent("3x3p", "3x3w", "3x3s", "3x3t");
    console.log("The points are: ");
    console.log(points);
    points += callCalculatePointsForOneEvent("4x4p", "4x4w", "4x4s", "4x4t");
    console.log("The points are: ");
    console.log(points);
    points += callCalculatePointsForOneEvent("3x3ohp", "3x3ohw", "3x3ohs", "3x3oht");
    console.log("The points are: ");
    console.log(points);
    points += callCalculatePointsForOneEvent("skewbp", "skewbw", "skewbs", "skewbt");
    console.log("The points are: ");
    console.log(points);
    points += callCalculatePointsForOneEvent("pyrap", "pyraw", "pyras", "pyrat");
    console.log("The points are: ");
    console.log(points);
    points += callCalculatePointsForOneEvent("2x2p", "2x2w", "2x2s", "2x2t");
    console.log("The points are: ");
    console.log(points);
    // points += calculatePointsForOneEvent(
    //   fantasyPodiumInfo["3x3p"],
    //   fantasyPodiumInfo["3x3w"],
    //   fantasyPodiumInfo["3x3s"],
    //   fantasyPodiumInfo["3x3t"], 
    //   document.getElementById("3x3w").value.trim(),
    //   document.getElementById("3x3s").value.trim(),
    //   document.getElementById("3x3t").value.trim()
    //   );

    console.log("The points are: ");
    console.log(points);
    finalList[currentName] = points;
    document.getElementById('first-id').style.display = "block";
    document.getElementById('second-id').style.display = "none";
    document.getElementById("enter-predictions-header").innerText = "Enter predictions for";
    document.getElementById("name-participant").value = "";
    var idsOfForm = ["3x3w", "3x3s", "3x3t", "4x4w", "4x4s", "4x4t", "3x3ohw", "3x3ohs", "3x3oht", "skewbw", "skewbs", "skewbt", "pyraw", "pyras", "pyrat", "2x2w", "2x2s", "2x2t"];
    $.each(idsOfForm, function( index, value ) {
      document.getElementById(value).value = "";
    });


    var sortable = [];
    for (var players in finalList) {
        sortable.push([players, finalList[players]]);
    }

    sortable.sort(function(a, b) {
        return b[1] - a[1];
    });

       $("#final-table").find("tr:gt(0)").remove();
  for (var key in sortable){
      $('#final-table tr:last').after('<tr><td>' + sortable[key][0] + '</td>' + '<td>' + sortable[key][1] + '</td></tr>');
  }

  localStorage["finalRankList"] = JSON.stringify(finalList);

  });
</script>

</html>
